<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Business Card</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            z-index: 1;
        }

        #arButton {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            z-index: 10;
        }
    </style>
</head>

<body>
<button id="arButton" onclick="onButtonClicked()">Enter AR</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>

    async function onButtonClicked() {

        const {state} = await navigator.permissions.query({ name: 'xr' });
        if (state === 'denied') {
            alert('XR permissions denied. Cannot start AR.');
            return;
        }
        if (!navigator.xr) {
            alert("WebXR is not supported on this device/browser.");
            return;
        }

        // Add a canvas element and initialize a WebGL context that is compatible with WebXR.
        const canvas = document.createElement("canvas");
        document.body.appendChild(canvas);
        const gl = canvas.getContext("webgl", {xrCompatible: true});

        if (!gl) {
            alert("WebGL context could not be initialized. AR might not be supported.");
            return;
        }

        const scene = new THREE.Scene();

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.3);
        directionalLight.position.set(10, 15, 10);
        scene.add(directionalLight);

        const renderer = new THREE.WebGLRenderer({
            alpha: true,
            preserveDrawingBuffer: true,
            canvas: canvas,
            context: gl
        });
        renderer.autoClear = false;
        renderer.setSize(window.innerWidth, window.innerHeight);

        const camera = new THREE.PerspectiveCamera();
        camera.matrixAutoUpdate = false;
        camera.position.z = 5;

        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        // Load the texture for the resume
        const resumeTexture = new THREE.TextureLoader().load('path-to-your-resume-image.jpg');

        // Global variable to store the resume plane
        let resumePlane;

        // Set up XR session
        const session = await navigator.xr.requestSession('immersive-ar'); // To keep track of the current XR session

        session.updateRenderState({
            baseLayer: new XRWebGLLayer(session, renderer.context)
        });

        const referenceSpace = await session.requestReferenceSpace('local');

        function showResume() {
            const aspectRatio = resumeTexture.image.width / resumeTexture.image.height;
            const planeGeometry = new THREE.PlaneGeometry(4 * aspectRatio, 4);  // Adjust the size as needed
            const planeMaterial = new THREE.MeshBasicMaterial({map: resumeTexture, side: THREE.DoubleSide});
            resumePlane = new THREE.Mesh(planeGeometry, planeMaterial);
            resumePlane.position.set(0, 0, -5);
            scene.add(resumePlane);
        }

        function onButtonClick(mesh, url) {
            mesh.material.color.set(0xff0000);  // Change color to red as a click effect
            setTimeout(() => {
                mesh.material.color.set(0x007bff);  // Reset color after 500ms
                if (url) {
                    window.location.href = url;
                } else {
                    // Display contact info or resume
                    if (mesh === resumeButton) {
                        if (!resumePlane) {
                            showResume();
                        } else {
                            scene.remove(resumePlane);
                            resumePlane = null;
                        }
                    } else {
                        // Add your showContactInfo() function logic here
                    }
                }
            }, 500);
        }


        renderer.domElement.addEventListener('click', (event) => {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);

            const intersects = raycaster.intersectObjects(scene.children);
            for (let i = 0; i < intersects.length; i++) {
                if (intersects[i].object === githubButton) {
                    onButtonClick(githubButton, 'https://github.com/ConnerC0');
                } else if (intersects[i].object === linkedinButton) {
                    onButtonClick(linkedinButton, 'https://www.linkedin.com/in/conner-curtis/');
                } else if (intersects[i].object === contactButton) {
                    onButtonClick(contactButton);
                } else if (intersects[i].object === resumeButton) {
                    onButtonClick(resumeButton);
                } else if (intersects[i].object === resumePlane) {
                    scene.remove(resumePlane);
                    resumePlane = null;
                }
            }
        });

        // ... [Your other button setups and 3D objects]

        // Define different colors for the buttons
        const githubColor = 0xFF5733;  // Example color for Github button
        const linkedinColor = 0x33FF57;  // Example color for LinkedIn button
        const contactColor = 0x3357FF;  // Example color for Contact button
        const resumeColor = 0xFF33D6;  // Example color for Resume button

        // Button setup
        const buttonGeometry = new THREE.BoxGeometry(1, 0.2, 0.1);

        const githubMaterial = new THREE.MeshBasicMaterial({color: githubColor});
        const linkedinMaterial = new THREE.MeshBasicMaterial({color: linkedinColor});
        const contactMaterial = new THREE.MeshBasicMaterial({color: contactColor});
        const resumeMaterial = new THREE.MeshBasicMaterial({color: resumeColor});

        const githubButton = new THREE.Mesh(buttonGeometry, githubMaterial);
        githubButton.position.set(0, 1.5, -4); // Topmost position
        scene.add(githubButton);

        const linkedinButton = new THREE.Mesh(buttonGeometry, linkedinMaterial);
        linkedinButton.position.set(0, 0.9, -4); // 0.3 units below the Github button
        scene.add(linkedinButton);

        const contactButton = new THREE.Mesh(buttonGeometry, contactMaterial);
        contactButton.position.set(0, 0.3, -4); // 0.6 units below the Github button
        scene.add(contactButton);

        const resumeButton = new THREE.Mesh(buttonGeometry, resumeMaterial);
        resumeButton.position.set(0, -0.3, -4); // 0.9 units below the Github button
        scene.add(resumeButton);

        const onXRFrame = (time, frame) => {
            // Queue up the next draw request.
            session.requestAnimationFrame(onXRFrame);

            // Bind the graphics framebuffer to the baseLayer's framebuffer
            gl.bindFramebuffer(gl.FRAMEBUFFER, session.renderState.baseLayer.framebuffer)

            // Retrieve the pose of the device.
            // XRFrame.getViewerPose can return null while the session attempts to establish tracking.
            const pose = frame.getViewerPose(referenceSpace);
            if (pose) {
                // In mobile AR, we only have one view.
                const view = pose.views[0];

                const viewport = session.renderState.baseLayer.getViewport(view);
                renderer.setSize(viewport.width, viewport.height)

                // Use the view's transform matrix and projection matrix to configure the THREE.camera.
                camera.matrix.fromArray(view.transform.matrix)
                camera.projectionMatrix.fromArray(view.projectionMatrix);
                camera.updateMatrixWorld(true);


                // Render the scene with THREE.WebGLRenderer.
                renderer.render(scene, camera)
            }
        }
        session.requestAnimationFrame(onXRFrame);
    }

</script>
</body>

</html>
